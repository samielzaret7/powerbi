Bot (Hovered Slot, First) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
RETURN
IF (
    OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
    BLANK(),
    MINX (
        CALCULATETABLE (
            VALUES ( ScheduleSlots[Bot Name] ),
            TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
            TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
        ),
        [Bot Name]
    )
)

Comment (Hovered Slot, First) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
RETURN
IF (
    OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
    BLANK(),
    MINX (
        CALCULATETABLE (
            VALUES ( ScheduleSlots[Comentarios] ),
            TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
            TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
        ),
        [Comentarios]
    )
)





---------------------------

Bots (Hovered Slot) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
RETURN
IF (
    OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
    BLANK(),
    CONCATENATEX (
        CALCULATETABLE (
            VALUES ( ScheduleSlots[Bot Name] ),
            TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
            TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
        ),
        ScheduleSlots[Bot Name],
        ", "
    )
)


Comments (Hovered Slot) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
RETURN
IF (
    OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
    BLANK(),
    CONCATENATEX (
        CALCULATETABLE (
            VALUES ( ScheduleSlots[Comentarios] ),
            TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
            TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
        ),
        ScheduleSlots[Comentarios],
        UNICHAR ( 10 )   -- newline between comments if multiple bots
    )
)




-----------------------------

Bots (Hovered Slot) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
VAR BotList =
    IF (
        OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
        BLANK(),
        CONCATENATEX (
            CALCULATETABLE (
                VALUES ( ScheduleSlots[Bot Name] ),
                TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
                TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
            ),
            ScheduleSlots[Bot Name],
            ", "
        )
    )
RETURN
IF ( ISBLANK(BotList), "Slot is free", BotList )



Comments (Hovered Slot) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
VAR CommentList =
    IF (
        OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
        BLANK(),
        CONCATENATEX (
            CALCULATETABLE (
                VALUES ( ScheduleSlots[Comentarios] ),
                TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
                TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
            ),
            ScheduleSlots[Comentarios],
            UNICHAR(10)
        )
    )
RETURN
IF ( ISBLANK(CommentList), " ", CommentList )



-----------------------------

Bot Full Time Range :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )

-- Which bot (if any) is occupying this slot?
VAR BotSel =
    CALCULATE (
        SELECTEDVALUE ( ScheduleSlots[Bot Name] ),
        TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
        TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
    )

-- If no bot, we show “Slot is free”
VAR HasBot = NOT ISBLANK ( BotSel )

-- Get all the occupied slots for that same bot & server
VAR BotSlots =
    CALCULATETABLE (
        VALUES ( ScheduleSlots[SlotStartLocal] ),
        ScheduleSlots[Server] = ServerSel,
        ScheduleSlots[Bot Name] = BotSel
    )

-- Find earliest start and latest end time across that bot's schedule
VAR MinStart =
    CALCULATE (
        MIN ( ScheduleSlots[SlotStartLocal] ),
        ScheduleSlots[Server] = ServerSel,
        ScheduleSlots[Bot Name] = BotSel
    )
VAR MaxEnd =
    CALCULATE (
        MAX ( ScheduleSlots[SlotEndLocal] ),
        ScheduleSlots[Server] = ServerSel,
        ScheduleSlots[Bot Name] = BotSel
    )

RETURN
IF (
    NOT HasBot,
    "Slot is free",
    FORMAT ( MinStart, "hh:mm AM/PM" ) & " - " & FORMAT ( MaxEnd, "hh:mm AM/PM" )
)

-------------------------------------------


User (Hovered Slot) :=
VAR ServerSel    = SELECTEDVALUE ( Master_MachineSlot[Server] )
VAR SlotStartSel = SELECTEDVALUE ( Master_MachineSlot[SlotStartLocal] )
VAR UserList =
    IF (
        OR ( ISBLANK(ServerSel), ISBLANK(SlotStartSel) ),
        BLANK(),
        CONCATENATEX (
            CALCULATETABLE (
                VALUES ( ScheduleSlots[Usuario] ),
                TREATAS ( { ServerSel },    ScheduleSlots[Server] ),
                TREATAS ( { SlotStartSel }, ScheduleSlots[SlotStartLocal] )
            ),
            ScheduleSlots[Usuario],
            ", "
        )
    )
RETURN
IF ( ISBLANK(UserList), " ", UserList )
